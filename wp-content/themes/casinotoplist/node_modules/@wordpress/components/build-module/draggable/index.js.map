{"version":3,"sources":["@wordpress/components/src/draggable/index.js"],"names":["noop","Component","withSafeTimeout","dragImageClass","cloneWrapperClass","cloneHeightTransformationBreakpoint","clonePadding","Draggable","arguments","onDragStart","bind","onDragOver","onDragEnd","resetDragState","event","props","preventDefault","setTimeout","cloneWrapper","style","top","parseInt","clientY","cursorTop","left","clientX","cursorLeft","elementId","transferData","element","document","getElementById","dataTransfer","setDragImage","dragImage","createElement","id","classList","add","body","appendChild","removeChild","setData","JSON","stringify","elementRect","getBoundingClientRect","elementWrapper","parentNode","elementTopOffset","elementLeftOffset","clone","cloneNode","width","height","transform","transformOrigin","Array","from","querySelectorAll","forEach","child","addEventListener","removeEventListener","remove","children","onDraggableStart","onDraggableEnd"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withSafeTimeout } from '@wordpress/compose';\n\nconst dragImageClass = 'components-draggable__invisible-drag-image';\nconst cloneWrapperClass = 'components-draggable__clone';\nconst cloneHeightTransformationBreakpoint = 700;\nconst clonePadding = 20;\n\nclass Draggable extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onDragStart = this.onDragStart.bind( this );\n\t\tthis.onDragOver = this.onDragOver.bind( this );\n\t\tthis.onDragEnd = this.onDragEnd.bind( this );\n\t\tthis.resetDragState = this.resetDragState.bind( this );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.resetDragState();\n\t}\n\n\t/**\n\t * Removes the element clone, resets cursor, and removes drag listener.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragEnd( event ) {\n\t\tconst { onDragEnd = noop } = this.props;\n\t\tevent.preventDefault();\n\n\t\tthis.resetDragState();\n\t\tthis.props.setTimeout( onDragEnd );\n\t}\n\n\t/**\n\t * Updates positioning of element clone based on mouse movement during dragging.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragOver( event ) {\n\t\tthis.cloneWrapper.style.top = `${ parseInt(\n\t\t\tthis.cloneWrapper.style.top,\n\t\t\t10\n\t\t) +\n\t\t\tevent.clientY -\n\t\t\tthis.cursorTop }px`;\n\t\tthis.cloneWrapper.style.left = `${ parseInt(\n\t\t\tthis.cloneWrapper.style.left,\n\t\t\t10\n\t\t) +\n\t\t\tevent.clientX -\n\t\t\tthis.cursorLeft }px`;\n\n\t\t// Update cursor coordinates.\n\t\tthis.cursorLeft = event.clientX;\n\t\tthis.cursorTop = event.clientY;\n\t}\n\n\t/**\n\t * This method does a couple of things:\n\t *\n\t * - Clones the current element and spawns clone over original element.\n\t * - Adds a fake temporary drag image to avoid browser defaults.\n\t * - Sets transfer data.\n\t * - Adds dragover listener.\n\t *\n\t * @param  {Object} event The non-custom DragEvent.\n\t */\n\tonDragStart( event ) {\n\t\tconst { elementId, transferData, onDragStart = noop } = this.props;\n\t\tconst element = document.getElementById( elementId );\n\t\tif ( ! element ) {\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Set a fake drag image to avoid browser defaults. Remove from DOM\n\t\t// right after. event.dataTransfer.setDragImage is not supported yet in\n\t\t// IE, we need to check for its existence first.\n\t\tif ( 'function' === typeof event.dataTransfer.setDragImage ) {\n\t\t\tconst dragImage = document.createElement( 'div' );\n\t\t\tdragImage.id = `drag-image-${ elementId }`;\n\t\t\tdragImage.classList.add( dragImageClass );\n\t\t\tdocument.body.appendChild( dragImage );\n\t\t\tevent.dataTransfer.setDragImage( dragImage, 0, 0 );\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tdocument.body.removeChild( dragImage );\n\t\t\t} );\n\t\t}\n\n\t\tevent.dataTransfer.setData( 'text', JSON.stringify( transferData ) );\n\n\t\t// Prepare element clone and append to element wrapper.\n\t\tconst elementRect = element.getBoundingClientRect();\n\t\tconst elementWrapper = element.parentNode;\n\t\tconst elementTopOffset = parseInt( elementRect.top, 10 );\n\t\tconst elementLeftOffset = parseInt( elementRect.left, 10 );\n\t\tconst clone = element.cloneNode( true );\n\t\tclone.id = `clone-${ elementId }`;\n\t\tthis.cloneWrapper = document.createElement( 'div' );\n\t\tthis.cloneWrapper.classList.add( cloneWrapperClass );\n\t\tthis.cloneWrapper.style.width = `${ elementRect.width +\n\t\t\tclonePadding * 2 }px`;\n\n\t\tif ( elementRect.height > cloneHeightTransformationBreakpoint ) {\n\t\t\t// Scale down clone if original element is larger than 700px.\n\t\t\tthis.cloneWrapper.style.transform = 'scale(0.5)';\n\t\t\tthis.cloneWrapper.style.transformOrigin = 'top left';\n\t\t\t// Position clone near the cursor.\n\t\t\tthis.cloneWrapper.style.top = `${ event.clientY - 100 }px`;\n\t\t\tthis.cloneWrapper.style.left = `${ event.clientX }px`;\n\t\t} else {\n\t\t\t// Position clone right over the original element (20px padding).\n\t\t\tthis.cloneWrapper.style.top = `${ elementTopOffset -\n\t\t\t\tclonePadding }px`;\n\t\t\tthis.cloneWrapper.style.left = `${ elementLeftOffset -\n\t\t\t\tclonePadding }px`;\n\t\t}\n\n\t\t// Hack: Remove iFrames as it's causing the embeds drag clone to freeze\n\t\tArray.from( clone.querySelectorAll( 'iframe' ) ).forEach( ( child ) =>\n\t\t\tchild.parentNode.removeChild( child )\n\t\t);\n\n\t\tthis.cloneWrapper.appendChild( clone );\n\t\telementWrapper.appendChild( this.cloneWrapper );\n\n\t\t// Mark the current cursor coordinates.\n\t\tthis.cursorLeft = event.clientX;\n\t\tthis.cursorTop = event.clientY;\n\t\t// Update cursor to 'grabbing', document wide.\n\t\tdocument.body.classList.add( 'is-dragging-components-draggable' );\n\t\tdocument.addEventListener( 'dragover', this.onDragOver );\n\n\t\tthis.props.setTimeout( onDragStart );\n\t}\n\n\t/**\n\t * Cleans up drag state when drag has completed, or component unmounts\n\t * while dragging.\n\t */\n\tresetDragState() {\n\t\t// Remove drag clone\n\t\tdocument.removeEventListener( 'dragover', this.onDragOver );\n\t\tif ( this.cloneWrapper && this.cloneWrapper.parentNode ) {\n\t\t\tthis.cloneWrapper.parentNode.removeChild( this.cloneWrapper );\n\t\t\tthis.cloneWrapper = null;\n\t\t}\n\n\t\t// Reset cursor.\n\t\tdocument.body.classList.remove( 'is-dragging-components-draggable' );\n\t}\n\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn children( {\n\t\t\tonDraggableStart: this.onDragStart,\n\t\t\tonDraggableEnd: this.onDragEnd,\n\t\t} );\n\t}\n}\n\nexport default withSafeTimeout( Draggable );\n"]}