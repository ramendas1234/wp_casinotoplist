{"version":3,"sources":["@wordpress/components/src/autocomplete/index.js"],"names":["filterOptions","search","options","maxResults","filtered","i","length","option","keywords","label","isMatch","some","keyword","test","push","getRange","selection","window","getSelection","rangeCount","getRangeAt","Autocomplete","selectedIndex","suppress","undefined","open","query","filteredOptions","arguments","select","bind","reset","resetWhenSuppressed","handleKeyDown","debouncedLoadOptions","loadOptions","state","constructor","getInitialState","replacement","props","record","onChange","end","start","triggerPrefix","toInsert","html","onReplace","getOptionCompletion","isDisabled","completion","value","action","insertCompletion","setState","idx","debouncedSpeak","completer","promise","activePromise","Promise","resolve","then","optionsData","keyedOptions","map","optionData","optionIndex","key","getOptionLabel","getOptionKeywords","isOptionDisabled","announce","event","keyCode","SPACE","ctrlKey","shiftKey","altKey","metaKey","preventDefault","stopPropagation","UP","DOWN","LEFT","RIGHT","nextSelectedIndex","ESCAPE","ENTER","prevProps","completers","prevRecord","text","prevText","textAfterSelection","allCompleters","allowContext","index","lastIndexOf","slice","safeTrigger","match","RegExp","wasOpen","wasSuppress","wasQuery","isDebounced","cancel","children","instanceId","isSelected","selectedKey","className","isExpanded","listBoxId","activeId","onKeyDown","Component","withSpokenMessages","withInstanceId"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { escapeRegExp, find, map, debounce, deburr } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component, renderToString } from '@wordpress/element';\nimport {\n\tENTER,\n\tESCAPE,\n\tUP,\n\tDOWN,\n\tLEFT,\n\tRIGHT,\n\tSPACE,\n} from '@wordpress/keycodes';\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { withInstanceId, compose } from '@wordpress/compose';\nimport {\n\tcreate,\n\tslice,\n\tinsert,\n\tisCollapsed,\n\tgetTextContent,\n} from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport Button from '../button';\nimport Popover from '../popover';\nimport withSpokenMessages from '../higher-order/with-spoken-messages';\n\n/**\n * A raw completer option.\n *\n * @typedef {*} CompleterOption\n */\n\n/**\n * @callback FnGetOptions\n *\n * @return {(CompleterOption[]|Promise.<CompleterOption[]>)} The completer options or a promise for them.\n */\n\n/**\n * @callback FnGetOptionKeywords\n * @param {CompleterOption} option a completer option.\n *\n * @return {string[]} list of key words to search.\n */\n\n/**\n * @callback FnIsOptionDisabled\n * @param {CompleterOption} option a completer option.\n *\n * @return {string[]} whether or not the given option is disabled.\n */\n\n/**\n * @callback FnGetOptionLabel\n * @param {CompleterOption} option a completer option.\n *\n * @return {(string|Array.<(string|Component)>)} list of react components to render.\n */\n\n/**\n * @callback FnAllowContext\n * @param {string} before the string before the auto complete trigger and query.\n * @param {string} after  the string after the autocomplete trigger and query.\n *\n * @return {boolean} true if the completer can handle.\n */\n\n/**\n * @typedef {Object} OptionCompletion\n * @property {'insert-at-caret'|'replace'} action the intended placement of the completion.\n * @property {OptionCompletionValue} value the completion value.\n */\n\n/**\n * A completion value.\n *\n * @typedef {(string|WPElement|Object)} OptionCompletionValue\n */\n\n/**\n * @callback FnGetOptionCompletion\n * @param {CompleterOption} value the value of the completer option.\n * @param {string} query the text value of the autocomplete query.\n *\n * @return {(OptionCompletion|OptionCompletionValue)} the completion for the given option. If an\n * \t\t\t\t\t\t\t\t\t\t\t\t\t   OptionCompletionValue is returned, the\n * \t\t\t\t\t\t\t\t\t\t\t\t\t   completion action defaults to `insert-at-caret`.\n */\n\n/**\n * @typedef {Object} WPCompleter\n * @property {string} name a way to identify a completer, useful for selective overriding.\n * @property {?string} className A class to apply to the popup menu.\n * @property {string} triggerPrefix the prefix that will display the menu.\n * @property {(CompleterOption[]|FnGetOptions)} options the completer options or a function to get them.\n * @property {?FnGetOptionKeywords} getOptionKeywords get the keywords for a given option.\n * @property {?FnIsOptionDisabled} isOptionDisabled get whether or not the given option is disabled.\n * @property {FnGetOptionLabel} getOptionLabel get the label for a given option.\n * @property {?FnAllowContext} allowContext filter the context under which the autocomplete activates.\n * @property {FnGetOptionCompletion} getOptionCompletion get the completion associated with a given option.\n */\n\nfunction filterOptions( search, options = [], maxResults = 10 ) {\n\tconst filtered = [];\n\tfor ( let i = 0; i < options.length; i++ ) {\n\t\tconst option = options[ i ];\n\n\t\t// Merge label into keywords\n\t\tlet { keywords = [] } = option;\n\t\tif ( 'string' === typeof option.label ) {\n\t\t\tkeywords = [ ...keywords, option.label ];\n\t\t}\n\n\t\tconst isMatch = keywords.some( ( keyword ) =>\n\t\t\tsearch.test( deburr( keyword ) )\n\t\t);\n\t\tif ( ! isMatch ) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfiltered.push( option );\n\n\t\t// Abort early if max reached\n\t\tif ( filtered.length === maxResults ) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn filtered;\n}\n\nfunction getRange() {\n\tconst selection = window.getSelection();\n\treturn selection.rangeCount ? selection.getRangeAt( 0 ) : null;\n}\n\nexport class Autocomplete extends Component {\n\tstatic getInitialState() {\n\t\treturn {\n\t\t\tsearch: /./,\n\t\t\tselectedIndex: 0,\n\t\t\tsuppress: undefined,\n\t\t\topen: undefined,\n\t\t\tquery: undefined,\n\t\t\tfilteredOptions: [],\n\t\t};\n\t}\n\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.select = this.select.bind( this );\n\t\tthis.reset = this.reset.bind( this );\n\t\tthis.resetWhenSuppressed = this.resetWhenSuppressed.bind( this );\n\t\tthis.handleKeyDown = this.handleKeyDown.bind( this );\n\t\tthis.debouncedLoadOptions = debounce( this.loadOptions, 250 );\n\n\t\tthis.state = this.constructor.getInitialState();\n\t}\n\n\tinsertCompletion( replacement ) {\n\t\tconst { open, query } = this.state;\n\t\tconst { record, onChange } = this.props;\n\t\tconst end = record.start;\n\t\tconst start = end - open.triggerPrefix.length - query.length;\n\t\tconst toInsert = create( { html: renderToString( replacement ) } );\n\n\t\tonChange( insert( record, toInsert, start, end ) );\n\t}\n\n\tselect( option ) {\n\t\tconst { onReplace } = this.props;\n\t\tconst { open, query } = this.state;\n\t\tconst { getOptionCompletion } = open || {};\n\n\t\tif ( option.isDisabled ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( getOptionCompletion ) {\n\t\t\tconst completion = getOptionCompletion( option.value, query );\n\n\t\t\tconst { action, value } =\n\t\t\t\tundefined === completion.action ||\n\t\t\t\tundefined === completion.value\n\t\t\t\t\t? { action: 'insert-at-caret', value: completion }\n\t\t\t\t\t: completion;\n\n\t\t\tif ( 'replace' === action ) {\n\t\t\t\tonReplace( [ value ] );\n\t\t\t} else if ( 'insert-at-caret' === action ) {\n\t\t\t\tthis.insertCompletion( value );\n\t\t\t}\n\t\t}\n\n\t\t// Reset autocomplete state after insertion rather than before\n\t\t// so insertion events don't cause the completion menu to redisplay.\n\t\tthis.reset();\n\t}\n\n\treset() {\n\t\tthis.setState( this.constructor.getInitialState() );\n\t}\n\n\tresetWhenSuppressed() {\n\t\tconst { open, suppress } = this.state;\n\t\tif ( open && suppress === open.idx ) {\n\t\t\tthis.reset();\n\t\t}\n\t}\n\n\tannounce( filteredOptions ) {\n\t\tconst { debouncedSpeak } = this.props;\n\t\tif ( ! debouncedSpeak ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( !! filteredOptions.length ) {\n\t\t\tdebouncedSpeak(\n\t\t\t\tsprintf(\n\t\t\t\t\t_n(\n\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\tfilteredOptions.length\n\t\t\t\t\t),\n\t\t\t\t\tfilteredOptions.length\n\t\t\t\t),\n\t\t\t\t'assertive'\n\t\t\t);\n\t\t} else {\n\t\t\tdebouncedSpeak( __( 'No results.' ), 'assertive' );\n\t\t}\n\t}\n\n\t/**\n\t * Load options for an autocompleter.\n\t *\n\t * @param {WPCompleter} completer The autocompleter.\n\t * @param {string}      query     The query, if any.\n\t */\n\tloadOptions( completer, query ) {\n\t\tconst { options } = completer;\n\n\t\t/*\n\t\t * We support both synchronous and asynchronous retrieval of completer options\n\t\t * but internally treat all as async so we maintain a single, consistent code path.\n\t\t *\n\t\t * Because networks can be slow, and the internet is wonderfully unpredictable,\n\t\t * we don't want two promises updating the state at once. This ensures that only\n\t\t * the most recent promise will act on `optionsData`. This doesn't use the state\n\t\t * because `setState` is batched, and so there's no guarantee that setting\n\t\t * `activePromise` in the state would result in it actually being in `this.state`\n\t\t * before the promise resolves and we check to see if this is the active promise or not.\n\t\t */\n\t\tconst promise = ( this.activePromise = Promise.resolve(\n\t\t\ttypeof options === 'function' ? options( query ) : options\n\t\t).then( ( optionsData ) => {\n\t\t\tif ( promise !== this.activePromise ) {\n\t\t\t\t// Another promise has become active since this one was asked to resolve, so do nothing,\n\t\t\t\t// or else we might end triggering a race condition updating the state.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst keyedOptions = optionsData.map(\n\t\t\t\t( optionData, optionIndex ) => ( {\n\t\t\t\t\tkey: `${ completer.idx }-${ optionIndex }`,\n\t\t\t\t\tvalue: optionData,\n\t\t\t\t\tlabel: completer.getOptionLabel( optionData ),\n\t\t\t\t\tkeywords: completer.getOptionKeywords\n\t\t\t\t\t\t? completer.getOptionKeywords( optionData )\n\t\t\t\t\t\t: [],\n\t\t\t\t\tisDisabled: completer.isOptionDisabled\n\t\t\t\t\t\t? completer.isOptionDisabled( optionData )\n\t\t\t\t\t\t: false,\n\t\t\t\t} )\n\t\t\t);\n\n\t\t\tconst filteredOptions = filterOptions(\n\t\t\t\tthis.state.search,\n\t\t\t\tkeyedOptions\n\t\t\t);\n\t\t\tconst selectedIndex =\n\t\t\t\tfilteredOptions.length === this.state.filteredOptions.length\n\t\t\t\t\t? this.state.selectedIndex\n\t\t\t\t\t: 0;\n\t\t\tthis.setState( {\n\t\t\t\t[ 'options_' + completer.idx ]: keyedOptions,\n\t\t\t\tfilteredOptions,\n\t\t\t\tselectedIndex,\n\t\t\t} );\n\t\t\tthis.announce( filteredOptions );\n\t\t} ) );\n\t}\n\n\thandleKeyDown( event ) {\n\t\tconst { open, suppress, selectedIndex, filteredOptions } = this.state;\n\t\tif ( ! open ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( suppress === open.idx ) {\n\t\t\tswitch ( event.keyCode ) {\n\t\t\t\t// cancel popup suppression on CTRL+SPACE\n\t\t\t\tcase SPACE:\n\t\t\t\t\tconst { ctrlKey, shiftKey, altKey, metaKey } = event;\n\t\t\t\t\tif ( ctrlKey && ! ( shiftKey || altKey || metaKey ) ) {\n\t\t\t\t\t\tthis.setState( { suppress: undefined } );\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\t// reset on cursor movement\n\t\t\t\tcase UP:\n\t\t\t\tcase DOWN:\n\t\t\t\tcase LEFT:\n\t\t\t\tcase RIGHT:\n\t\t\t\t\tthis.reset();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif ( filteredOptions.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\tlet nextSelectedIndex;\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP:\n\t\t\t\tnextSelectedIndex =\n\t\t\t\t\t( selectedIndex === 0\n\t\t\t\t\t\t? filteredOptions.length\n\t\t\t\t\t\t: selectedIndex ) - 1;\n\t\t\t\tthis.setState( { selectedIndex: nextSelectedIndex } );\n\t\t\t\tbreak;\n\n\t\t\tcase DOWN:\n\t\t\t\tnextSelectedIndex =\n\t\t\t\t\t( selectedIndex + 1 ) % filteredOptions.length;\n\t\t\t\tthis.setState( { selectedIndex: nextSelectedIndex } );\n\t\t\t\tbreak;\n\n\t\t\tcase ESCAPE:\n\t\t\t\tthis.setState( { suppress: open.idx } );\n\t\t\t\tbreak;\n\n\t\t\tcase ENTER:\n\t\t\t\tthis.select( filteredOptions[ selectedIndex ] );\n\t\t\t\tbreak;\n\n\t\t\tcase LEFT:\n\t\t\tcase RIGHT:\n\t\t\t\tthis.reset();\n\t\t\t\treturn;\n\n\t\t\tdefault:\n\t\t\t\treturn;\n\t\t}\n\n\t\t// Any handled keycode should prevent original behavior. This relies on\n\t\t// the early return in the default case.\n\t\tevent.preventDefault();\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { record, completers } = this.props;\n\t\tconst { record: prevRecord } = prevProps;\n\n\t\tif ( isCollapsed( record ) ) {\n\t\t\tconst text = deburr( getTextContent( slice( record, 0 ) ) );\n\t\t\tconst prevText = deburr( getTextContent( slice( prevRecord, 0 ) ) );\n\n\t\t\tif ( text !== prevText ) {\n\t\t\t\tconst textAfterSelection = getTextContent(\n\t\t\t\t\tslice( record, undefined, getTextContent( record ).length )\n\t\t\t\t);\n\t\t\t\tconst allCompleters = map( completers, ( completer, idx ) => ( {\n\t\t\t\t\t...completer,\n\t\t\t\t\tidx,\n\t\t\t\t} ) );\n\t\t\t\tconst open = find(\n\t\t\t\t\tallCompleters,\n\t\t\t\t\t( { triggerPrefix, allowContext } ) => {\n\t\t\t\t\t\tconst index = text.lastIndexOf( triggerPrefix );\n\n\t\t\t\t\t\tif ( index === -1 ) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tallowContext &&\n\t\t\t\t\t\t\t! allowContext(\n\t\t\t\t\t\t\t\ttext.slice( 0, index ),\n\t\t\t\t\t\t\t\ttextAfterSelection\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn /^\\S*$/.test(\n\t\t\t\t\t\t\ttext.slice( index + triggerPrefix.length )\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif ( ! open ) {\n\t\t\t\t\tthis.reset();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst safeTrigger = escapeRegExp( open.triggerPrefix );\n\t\t\t\tconst match = text.match(\n\t\t\t\t\tnew RegExp( `${ safeTrigger }(\\\\S*)$` )\n\t\t\t\t);\n\t\t\t\tconst query = match && match[ 1 ];\n\t\t\t\tconst {\n\t\t\t\t\topen: wasOpen,\n\t\t\t\t\tsuppress: wasSuppress,\n\t\t\t\t\tquery: wasQuery,\n\t\t\t\t} = this.state;\n\n\t\t\t\tif (\n\t\t\t\t\topen &&\n\t\t\t\t\t( ! wasOpen ||\n\t\t\t\t\t\topen.idx !== wasOpen.idx ||\n\t\t\t\t\t\tquery !== wasQuery )\n\t\t\t\t) {\n\t\t\t\t\tif ( open.isDebounced ) {\n\t\t\t\t\t\tthis.debouncedLoadOptions( open, query );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.loadOptions( open, query );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// create a regular expression to filter the options\n\t\t\t\tconst search = open\n\t\t\t\t\t? new RegExp( '(?:\\\\b|\\\\s|^)' + escapeRegExp( query ), 'i' )\n\t\t\t\t\t: /./;\n\t\t\t\t// filter the options we already have\n\t\t\t\tconst filteredOptions = open\n\t\t\t\t\t? filterOptions(\n\t\t\t\t\t\t\tsearch,\n\t\t\t\t\t\t\tthis.state[ 'options_' + open.idx ]\n\t\t\t\t\t  )\n\t\t\t\t\t: [];\n\t\t\t\t// check if we should still suppress the popover\n\t\t\t\tconst suppress =\n\t\t\t\t\topen && wasSuppress === open.idx ? wasSuppress : undefined;\n\t\t\t\t// update the state\n\t\t\t\tif ( wasOpen || open ) {\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tselectedIndex: 0,\n\t\t\t\t\t\tfilteredOptions,\n\t\t\t\t\t\tsuppress,\n\t\t\t\t\t\tsearch,\n\t\t\t\t\t\topen,\n\t\t\t\t\t\tquery,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\t// announce the count of filtered options but only if they have loaded\n\t\t\t\tif ( open && this.state[ 'options_' + open.idx ] ) {\n\t\t\t\t\tthis.announce( filteredOptions );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.debouncedLoadOptions.cancel();\n\t}\n\n\trender() {\n\t\tconst { children, instanceId, isSelected } = this.props;\n\t\tconst { open, suppress, selectedIndex, filteredOptions } = this.state;\n\t\tconst { key: selectedKey = '' } =\n\t\t\tfilteredOptions[ selectedIndex ] || {};\n\t\tconst { className, idx } = open || {};\n\t\tconst isExpanded = suppress !== idx && filteredOptions.length > 0;\n\t\tconst listBoxId = isExpanded\n\t\t\t? `components-autocomplete-listbox-${ instanceId }`\n\t\t\t: null;\n\t\tconst activeId = isExpanded\n\t\t\t? `components-autocomplete-item-${ instanceId }-${ selectedKey }`\n\t\t\t: null;\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ children( {\n\t\t\t\t\tisExpanded,\n\t\t\t\t\tlistBoxId,\n\t\t\t\t\tactiveId,\n\t\t\t\t\tonKeyDown: this.handleKeyDown,\n\t\t\t\t} ) }\n\t\t\t\t{ isExpanded && isSelected && (\n\t\t\t\t\t<Popover\n\t\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\t\tonClose={ this.reset }\n\t\t\t\t\t\tposition=\"top right\"\n\t\t\t\t\t\tclassName=\"components-autocomplete__popover\"\n\t\t\t\t\t\tanchorRef={ getRange() }\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid={ listBoxId }\n\t\t\t\t\t\t\trole=\"listbox\"\n\t\t\t\t\t\t\tclassName=\"components-autocomplete__results\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ isExpanded &&\n\t\t\t\t\t\t\t\tmap( filteredOptions, ( option, index ) => (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tkey={ option.key }\n\t\t\t\t\t\t\t\t\t\tid={ `components-autocomplete-item-${ instanceId }-${ option.key }` }\n\t\t\t\t\t\t\t\t\t\trole=\"option\"\n\t\t\t\t\t\t\t\t\t\taria-selected={\n\t\t\t\t\t\t\t\t\t\t\tindex === selectedIndex\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdisabled={ option.isDisabled }\n\t\t\t\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t\t\t\t'components-autocomplete__result',\n\t\t\t\t\t\t\t\t\t\t\tclassName,\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t'is-selected':\n\t\t\t\t\t\t\t\t\t\t\t\t\tindex === selectedIndex,\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\tonClick={ () => this.select( option ) }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ option.label }\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Popover>\n\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default compose( [ withSpokenMessages, withInstanceId ] )(\n\tAutocomplete\n);\n"]}